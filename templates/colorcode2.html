<!DOCTYPE html>

{% extends "layouts/base.html" %}

{% block body %}
    <style>
        h1 {
            font-family: "Birthstone";
            text-align: center;
            font-size:80px
        }
        .center {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>

    <h1>ColorCode Lab</h1>

    <br />
    <!function that returns one less than what you give it>
    <!these for loops create the button that only apply to each row of bulbs since the range of i is specified>
    <div class="row">
        <div class="col-sm-1"></div>
        {% for i in range(1, 9) %}
            <button class="col-sm-1" id="r{{i}}" onclick="toggleCell('r{{i}}')">0</button>
        {% endfor %}
        <div class="offset-sm-1 col-sm-2">
            <p id="r">Decimal: 0</p>
        </div>
    </div>

    <br />

    <div class="row">
        <div class="col-sm-1"></div>
        {% for i in range(1, 9) %}
            <button class="col-sm-1" id="g{{i}}" onclick="toggleCell('g{{i}}')">0</button>
        {% endfor %}
        <div class="offset-sm-1 col-sm-2">
            <p id="g">Decimal: 0</p>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-sm-1"></div>
        {% for i in range(1, 9) %}
            <button class="col-sm-1" id="b{{i}}" onclick="toggleCell('b{{i}}')">0</button>
        {% endfor %}
        <div class="offset-sm-1 col-sm-2">
            <p id="b">Decimal: 0</p>
        </div>
    </div>

    <br />

    <div class="offset-sm-1 col-sm-10" id="color" style="background-color: #000000; height: 10vh;">
    </div>
    <p style="text-align: center;" id="code">Hexcode: #000000</p>

    <br />
    <div class = "container"> </div>
    <div class="center">
        <button style="justify-content: center;" onclick="reset()">Reset</button>
    </div>
    </div>

    <script>


        var colors = new Map(); //makes an array I think??
        colors.set('r', 0);
        colors.set('g', 0);
        colors.set('b', 0);

        function bin2int(binary){
            {#console.log(binary)#}
            return parseInt(binary, 2) //turns string into number, comma 2 specifies that input number is written in base 2
        }



        function totalRow (color) {    // gets decimal sum for row
            let binary = "";
            for (var i = 1; i <= 8; i++) {
                let element = document.getElementById(color + i);
                binary += parseInt(element.innerHTML);  //addition assignment operator, adds value to variable
            }
            sum = bin2int(binary)

            document.getElementById(color).innerHTML = "Decimal value: " + sum;
            colors.set(color, sum)
            setColorCode();
        }


        function setColorCode() {    // takes decimal values from each row, converts to base 16 (hex) and then ensures that its two digits
            let r = colors.get("r").toString(16);
            let g = colors.get("g").toString(16);
            let b = colors.get("b").toString(16);
            if (r.length == 1) {
                r = "0" + r;
            }
            if (g.length == 1) {
                g = "0" + g;
            }
            if (b.length == 1) {
                b = "0" + b;
            }
            let code = "#" + r + g + b;
            document.getElementById("color").style.backgroundColor = code;  //also changes color in box to corresponding hexcode
            document.getElementById("code").innerHTML = "Hexcode = " + code;

        }

        function toggleCell (cellid) {
            const element = document.getElementById(cellid);
            if (element.innerHTML == "1") {
                element.innerHTML = "0";
            } else {
                element.innerHTML = "1";
            }
            element.classList.toggle("On");
            element.classList.toggle("Off");

            totalRow(cellid.charAt(0));
        }

        function reset () {   // resets all cells to 0, color in box in black with reset button
            colorCode = ["r", "g", "b"];    //array parameters needs brackets, objects have {}
            for (var j = 0; j < 3; j++) {    //looping through rows
                for (var i = 1; i <= 8; i++) {  //also each cell
                    console.log(colorCode[j] + i);  //for testing
                    document.getElementById(colorCode[j] + i).innerHTML = "0";
                    totalRow(colorCode[j]);
                    document.getElementById(colorCode[j] + i).classList.add("Off");
                    document.getElementById(colorCode[j] + i).classList.remove("On");
                }
            }
        }

        window.onload = reset();  // everytime a new tab opens, you reset the cells
        console.log("loaded");  //for testing errors

    </script>

{% endblock %}

{% block background %}
    <body style="background-color:darkslategrey;">  </body>
{% endblock %}
// click cell, detect change, remake binary number for that row, convert to rgb, display color


